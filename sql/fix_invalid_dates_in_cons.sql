-- ============================================
-- –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ù–ï–í–ê–õ–ò–î–ù–´–• –î–ê–¢ –í –¢–ê–ë–õ–ò–¶–ï CONS
-- ============================================
--
-- –≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–µ –¥–∞—Ç—ã –≤ —Ç–∞–±–ª–∏—Ü–µ cons
-- (–ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏, —Å—Ç—Ä–æ–∫–∏ —Å –ø—Ä–æ–±–µ–ª–∞–º–∏ –∏ —Ç.–¥.)
--
-- –í–ê–ñ–ù–û: –í—ã–ø–æ–ª–Ω–∏—Ç–µ —ç—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –≤ Supabase SQL Editor –¥–ª—è production –ë–î
-- ============================================

-- ============================================
-- 1. –ü–†–û–í–ï–†–ö–ê –¢–ï–ö–£–©–ï–ì–û –°–û–°–¢–û–Ø–ù–ò–Ø
-- ============================================

-- –ü–æ—Å–º–æ—Ç—Ä–∏–º, —Å–∫–æ–ª—å–∫–æ –∑–∞–ø–∏—Å–µ–π —Å –ø—Ä–æ–±–ª–µ–º–Ω—ã–º–∏ –¥–∞—Ç–∞–º–∏
SELECT
  '–ó–∞–ø–∏—Å–∏ —Å NULL event_date' as issue,
  COUNT(*) as count
FROM cons
WHERE event_date IS NULL;

SELECT
  '–ó–∞–ø–∏—Å–∏ —Å NULL event_end_date' as issue,
  COUNT(*) as count
FROM cons
WHERE event_end_date IS NULL;

SELECT
  '–ó–∞–ø–∏—Å–∏ —Å NULL announced_date' as issue,
  COUNT(*) as count
FROM cons
WHERE announced_date IS NULL;

-- ============================================
-- 2. –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ù–ï–í–ê–õ–ò–î–ù–´–• –î–ê–¢
-- ============================================

-- –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –í PostgreSQL timestamp –ø–æ–ª—è –Ω–µ –º–æ–≥—É—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏
-- –û–Ω–∏ –º–æ–≥—É—Ç –±—ã—Ç—å —Ç–æ–ª—å–∫–æ NULL –∏–ª–∏ –≤–∞–ª–∏–¥–Ω—ã–º–∏ –¥–∞—Ç–∞–º–∏
-- –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏, –ø—Ä–æ–±–ª–µ–º–∞ —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ –≤ —Ç–æ–º,
-- —á—Ç–æ –¥–∞—Ç—ã –ø—Ä–∏—Ö–æ–¥—è—Ç –∏–∑ –ë–î –∫–∞–∫ NULL, –∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —ç—Ç–æ

-- –ü—Ä–æ–≤–µ—Ä–∏–º –µ—Å—Ç—å –ª–∏ –∑–∞–ø–∏—Å–∏ –≥–¥–µ event_date —Ç—Ä–µ–±—É–µ—Ç—Å—è, –Ω–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
-- (–¥–ª—è —Å–æ–±—ã—Ç–∏–π –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ö–æ—Ç—è –±—ã –¥–∞—Ç–∞ –Ω–∞—á–∞–ª–∞)
SELECT
  '–°–æ–±—ã—Ç–∏—è –±–µ–∑ –¥–∞—Ç—ã –Ω–∞—á–∞–ª–∞' as warning,
  COUNT(*) as count,
  string_agg(name, ', ' ORDER BY id LIMIT 5) as examples
FROM cons
WHERE event_date IS NULL;

-- ============================================
-- 3. –ü–†–û–í–ï–†–ö–ê –†–ï–ó–£–õ–¨–¢–ê–¢–û–í
-- ============================================

-- –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –¥–∞—Ç–∞–º
SELECT
  COUNT(*) as total_events,
  COUNT(event_date) as events_with_date,
  COUNT(*) - COUNT(event_date) as events_without_date,
  COUNT(event_end_date) as events_with_end_date,
  COUNT(announced_date) as events_with_announced_date
FROM cons;

-- –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –¥–∞—Ç–∞–º
SELECT
  COUNT(*) as total_events,
  COUNT(event_date) as events_with_date,
  COUNT(*) - COUNT(event_date) as events_without_date,
  COUNT(event_end_date) as events_with_end_date,
  COUNT(announced_date) as events_with_announced_date
FROM cons;

-- ============================================
-- –†–ï–ó–£–õ–¨–¢–ê–¢–´ –ü–†–û–í–ï–†–ö–ò
-- ============================================

SELECT '‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∑–∞–≤–µ—Ä—à–µ–Ω–∞!' AS status;
SELECT 'üìä –í PostgreSQL timestamp –ø–æ–ª—è –Ω–µ –º–æ–≥—É—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏' AS info;
SELECT 'üí° –ï—Å–ª–∏ –µ—Å—Ç—å —Å–æ–±—ã—Ç–∏—è –±–µ–∑ –¥–∞—Ç—ã - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è –ë–î' AS note;
SELECT 'üîß –û—à–∏–±–∫–∞ getDay() –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –≤ –∫–æ–¥–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ NULL)' AS fix;

-- ============================================
-- –ò–ù–°–¢–†–£–ö–¶–ò–ò
-- ============================================
--
-- –≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–∞—Ç –≤ —Ç–∞–±–ª–∏—Ü–µ cons
--
-- –í–ê–ñ–ù–û: –í PostgreSQL timestamp –ø–æ–ª—è –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º–∏ —Å—Ç—Ä–æ–∫–∞–º–∏.
-- –û–Ω–∏ –º–æ–≥—É—Ç –±—ã—Ç—å —Ç–æ–ª—å–∫–æ:
-- - NULL (–Ω–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è)
-- - –í–∞–ª–∏–¥–Ω–∞—è –¥–∞—Ç–∞
--
-- –û—à–∏–±–∫–∞ "e.getDay is not a function" –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –∏–∑-–∑–∞ —Ç–æ–≥–æ, —á—Ç–æ:
-- 1. –ò–∑ –ë–î –ø—Ä–∏—Ö–æ–¥–∏—Ç NULL
-- 2. –ö–æ–¥ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–ª NULL –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º new Date()
-- 3. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ - –≤ –∫–æ–¥–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (—É–∂–µ —Å–¥–µ–ª–∞–Ω–æ)
--
-- ============================================

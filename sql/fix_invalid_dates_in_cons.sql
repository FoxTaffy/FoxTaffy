-- ============================================
-- ДИАГНОСТИКА ДАТ В ТАБЛИЦЕ CONS
-- ============================================
--
-- Этот скрипт проверяет состояние дат в таблице cons
--
-- ВАЖНО: В PostgreSQL timestamp поля не могут быть пустыми строками.
-- Они могут быть только:
-- - NULL (нет значения)
-- - Валидная дата
--
-- Ошибка "e.getDay is not a function" возникала из-за того, что:
-- 1. Из БД приходит NULL
-- 2. Код не проверял NULL перед созданием new Date()
-- 3. Исправление - в коде приложения (уже сделано в коммите e0160ce)
--
-- ============================================

-- Полная статистика по датам в одном запросе
SELECT
  COUNT(*) as total_events,
  COUNT(event_date) as events_with_date,
  COUNT(*) - COUNT(event_date) as events_without_date,
  COUNT(event_end_date) as events_with_end_date,
  COUNT(announced_date) as events_with_announced_date,
  -- Показываем примеры событий без даты
  (SELECT string_agg(name, ', ') FROM (SELECT name FROM cons WHERE event_date IS NULL LIMIT 3) sub) as examples_without_date
FROM cons;

-- ============================================
-- РЕЗУЛЬТАТ
-- ============================================
-- Этот запрос покажет:
-- - Сколько всего событий
-- - Сколько с датой начала
-- - Сколько без даты начала
-- - Сколько с датой окончания
-- - Сколько с датой анонса
-- - Примеры событий без даты (максимум 3)
--
-- Если есть события без даты - это нормально.
-- Код приложения теперь корректно обрабатывает NULL значения.
-- ============================================
